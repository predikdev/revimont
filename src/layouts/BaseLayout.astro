---
import "../styles/globals.css";
import Header from "../components/layout/Header.astro";
import MobileNavigation from "../components/layout/MobileNavigation.astro";
import Footer from "../components/layout/Footer.astro";
import CookieConsent from "../components/ui/CookieConsent.astro";

const GA_ID = "G-XXXXXXXXXX";
---

<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <meta name="viewport" content="width=device-width" />
    <meta name="robots" content="noindex,nofollow,noarchive,nosnippet" />
    <meta name="generator" content={Astro.generator} />
    <title>Revimont Klatovy</title>
    <slot name="head" />

    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("consent", "default", {
        analytics_storage: "denied",
        ad_storage: "denied",
        ad_user_data: "denied",
        ad_personalization: "denied",
        wait_for_update: 500,
      });
      gtag("js", new Date());
    </script>

    <script is:inline async src={`https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX`}
    ></script>
    <script is:inline define:vars={{ GA_ID }}>
      gtag("config", GA_ID, { anonymize_ip: true });
    </script>
  </head>
  <body class="text-neutral-800">
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:px-4 focus:py-2 focus:bg-neutral-900 focus:text-white focus:rounded"
      >Přejít na hlavní obsah</a
    >
    <MobileNavigation />
    <Header />
    <div class="hero-wrapper">
      <slot name="hero" />
    </div>
    <main id="main-content">
      <slot />
    </main>
    <Footer eyebrow="Kde nás najdete" />
    <CookieConsent />
  </body>
</html>

<style>
  :global(.hero-wrapper) {
    position: relative;
    isolation: isolate;
  }

  :global(.hero-wrapper::after) {
    content: "";
    position: absolute;
    inset: 0;
    background-image: linear-gradient(to right, var(--color-neutral-800), var(--color-neutral-800));
    z-index: 1;
    pointer-events: none;
  }

  :global(.hero-wrapper > *) {
    position: relative;
    z-index: 2;
  }
</style>

<script>
  import Lenis from "lenis";

  // Initialize Lenis
  const lenis = new Lenis({
    duration: 0.3,
    smoothWheel: true,
    autoRaf: true,
  });
</script>

<script is:inline>
  {
    const reducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (!reducedMotion) {
      const sections = document.querySelectorAll("[data-animate-section]");

      sections.forEach((section) => {
        const rect = section.getBoundingClientRect();
        if (rect.top >= window.innerHeight - 60) {
          const container = section.querySelector(".container");
          if (!container) return;
          const [sectionHeader, cardsGrid] = container.children;
          if (sectionHeader) {
            sectionHeader.style.opacity = "0";
            sectionHeader.style.transform = "translateY(12px)";
          }
          if (cardsGrid) {
            cardsGrid.style.opacity = "0";
            cardsGrid.style.transform = "translateY(12px)";
          }
        }
      });

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (!entry.isIntersecting) return;
            const container = entry.target.querySelector(".container");
            if (!container) return;
            const [sectionHeader, cardsGrid] = container.children;
            if (sectionHeader) sectionHeader.classList.add("is-visible");
            if (cardsGrid) setTimeout(() => cardsGrid.classList.add("is-visible"), 150);
            observer.unobserve(entry.target);
          });
        },
        { threshold: 0.1, rootMargin: "0px 0px -60px 0px" },
      );

      sections.forEach((section) => observer.observe(section));
    }
  }
</script>
