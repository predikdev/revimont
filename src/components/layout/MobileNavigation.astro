---
import CloseMenu from "../../assets/icons/square-x.svg";
import PhoneIcon from "../../assets/icons/phone.svg";

import LogoInline from "./LogoInline.astro";
import Button from "../ui/Button.astro";

const links = [
  { href: "/", label: "Domů" },
  { href: "/sluzby", label: "Služby" },
  { href: "/o-nas", label: "O nás" },
  { href: "/reference", label: "Reference" },
  { href: "/kontakt", label: "Kontakt" },
];
---

<div
  class="group fixed inset-0 z-[100] pointer-events-none lg:hidden"
  id="mobile-menu-v2"
  data-open="false"
>
  <div
    class="absolute inset-0 bg-black/90 opacity-0 transition-opacity duration-300 group-data-[open=true]:opacity-100 group-data-[open=true]:pointer-events-auto backdrop-blur-sm"
    data-menu-backdrop
  >
  </div>

  <div
    class="absolute inset-0 translate-y-full bg-background-dark transition-transform duration-300 ease-out group-data-[open=true]:translate-y-0 group-data-[open=true]:pointer-events-auto overflow-y-auto"
  >
    <div class="container min-h-full flex flex-col py-6">
      <!-- Header -->
      <div class="flex items-center justify-between">
        <LogoInline class="w-40" dark={false} />
        <button
          type="button"
          aria-label="Zavřít menu"
          data-menu-close
          class="p-2 -m-2 text-primary hover:text-accent-primary transition-colors"
        >
          <CloseMenu class="h-6 w-6" />
        </button>
      </div>

      <nav class="mt-16 flex-1">
        <ul class="flex flex-col gap-1">
          {
            links.map((link) => (
              <li>
                <a
                  href={link.href}
                  class="block py-4 text-2xl font-medium text-primary hover:text-accent-primary transition-colors border-b border-white/10"
                >
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>

      <div class="mt-auto pt-8 space-y-4 border-t border-white/10">
        <a
          href="tel:+420775736112"
          class="flex items-center justify-center gap-3 py-3 text-primary hover:text-accent-primary transition-colors group"
        >
          <PhoneIcon class="w-5 h-5" />
          <span class="text-lg font-semibold">+420 775 736 112</span>
        </a>
        <Button variant="primary" href="/kontakt" class="w-full" size="lg">
          Nezávazná poptávka
        </Button>
      </div>
    </div>
  </div>
</div>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    const menu = document.querySelector("#mobile-menu-v2");
    const openBtn = document.querySelector("[data-menu-open]");
    const closeBtn = document.querySelector("[data-menu-close]");
    const backdrop = document.querySelector("[data-menu-backdrop]");

    if (!menu || !openBtn) return;

    const openMenu = () => {
      menu.setAttribute("data-open", "true");
      document.documentElement.classList.add("no-scroll");
      document.body.classList.add("no-scroll");
    };

    const closeMenu = () => {
      menu.setAttribute("data-open", "false");
      document.documentElement.classList.remove("no-scroll");
      document.body.classList.remove("no-scroll");
    };

    openBtn.addEventListener("click", openMenu);
    closeBtn?.addEventListener("click", closeMenu);
    backdrop?.addEventListener("click", closeMenu);

    menu.addEventListener("click", (event) => {
      if (!(event.target instanceof Element)) return;
      if (event.target.closest("a,button,[data-menu-close]")) closeMenu();
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") closeMenu();
    });
  });
</script>
