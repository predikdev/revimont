---
const stats = [
  { value: "15+", label: "Let zkušeností", countTo: 15, suffix: "+" },
  { value: "300+", label: "Dokončených projektů", countTo: 300, suffix: "+" },
  { value: "100%", label: "Funkčnost", countTo: 100, suffix: "%" },
  { value: "Klatovy", label: "A široké okolí", countTo: null, suffix: "" },
];
---

<section class="bg-accent-primary py-10">
  <div class="container">
    <div
      class="grid grid-cols-2 gap-8 lg:grid-cols-4 lg:gap-0 lg:divide-x lg:divide-white/20"
    >
      {
        stats.map((stat) => (
          <div class="flex flex-col items-center text-center lg:px-8">
            <span
              class="font-sora mb-2 text-4xl leading-none font-bold text-white lg:text-5xl"
              data-count-to={stat.countTo !== null ? stat.countTo : undefined}
              data-count-suffix={stat.suffix || undefined}
            >
              {stat.value}
            </span>
            <span class="mb-1 text-sm font-bold tracking-wide text-white/90 uppercase">
              {stat.label}
            </span>
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  const reducedMotion = window.matchMedia(
    "(prefers-reduced-motion: reduce)",
  ).matches;
  const counters = document.querySelectorAll<HTMLElement>("[data-count-to]");

  function animateCounter(counter: HTMLElement) {
    const target = parseInt(counter.dataset.countTo ?? "0", 10);
    const suffix = counter.dataset.countSuffix ?? "";
    const duration = 1400;
    const startTime = performance.now();

    function tick(now: number) {
      const elapsed = now - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const eased = 1 - Math.pow(1 - progress, 3);
      counter.textContent = Math.round(eased * target) + suffix;
      if (progress < 1) requestAnimationFrame(tick);
    }

    requestAnimationFrame(tick);
  }

  if (counters.length > 0 && !reducedMotion) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            animateCounter(entry.target as HTMLElement);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.5 },
    );

    counters.forEach((counter) => observer.observe(counter));
  }
</script>
